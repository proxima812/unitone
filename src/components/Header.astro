---
import Container from "./Container.astro";
import Logo from "./Logo.astro";
import Menu from "./Menu.astro";
---

<header
	id="header"
	class="sticky top-0 z-50 mx-0 mt-0 w-full max-w-4xl rounded-none border-b border-[color:var(--border)] bg-[color:var(--surface)]/90 py-4 backdrop-blur transition-transform duration-300 will-change-transform md:top-5 md:mx-auto md:mt-5 md:rounded-2xl md:border"
>
	<Container class="flex justify-between gap-x-3">
		<Logo />
		<Menu />
	</Container>
</header>

<script>
	const header = document.getElementById("header");
	let lastY = window.scrollY;
	let ticking = false;
	const DELTA_THRESHOLD = 8;
	const TOP_OFFSET = 24;

	const updateHeader = () => {
		const currentY = window.scrollY;

		if (!header) {
			ticking = false;
			return;
		}

		if (currentY <= TOP_OFFSET) {
			header.classList.remove("-translate-y-full");
			lastY = currentY;
			ticking = false;
			return;
		}

		const delta = currentY - lastY;
		if (Math.abs(delta) < DELTA_THRESHOLD) {
			ticking = false;
			return;
		}

		if (delta > 0) {
			header.classList.add("-translate-y-full");
		} else {
			header.classList.remove("-translate-y-full");
		}

		lastY = currentY;
		ticking = false;
	};

	window.addEventListener(
		"scroll",
		() => {
			if (ticking) return;
			ticking = true;
			window.requestAnimationFrame(updateHeader);
		},
		{ passive: true },
	);
</script>
