---
import { LOCALES } from "@/lib/i18n-runtime"
---

<label class="inline-flex items-center gap-2 rounded-lg border border-[color:var(--border)] bg-[color:var(--surface)] px-2 py-1.5 text-sm text-[color:var(--text)]">
	<span class="sr-only" data-i18n="lang.label">Язык</span>
	<select
		id="language-switcher"
		class="bg-transparent pr-1 outline-none"
		title="Language"
		data-i18n-title="lang.label"
	>
		{LOCALES.map((locale) => <option value={locale.code}>{locale.label}</option>)}
	</select>
</label>

<script>
	const select = document.getElementById("language-switcher") as HTMLSelectElement | null

	const sync = () => {
		if (!select) return
		const locale = document.documentElement.getAttribute("data-locale") || "ru"
		if (select.value !== locale) select.value = locale
	}

	sync()
	window.addEventListener("unitone:locale-updated", sync)

	select?.addEventListener("change", () => {
		window.dispatchEvent(
			new CustomEvent("unitone:locale-change", {
				detail: { locale: select.value },
			}),
		)
	})
</script>
