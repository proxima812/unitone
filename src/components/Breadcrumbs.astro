---
interface Props {
	currentLabel?: string
}

const { currentLabel } = Astro.props as Props
const { pathname } = Astro.url
const cleanPath = pathname.replace(/\/+$/, "") || "/"
const parts = cleanPath.split("/").filter(Boolean)

const labelMap: Record<string, { label: string }> = {
	archive: { label: "Архив" },
	methods: { label: "Методы" },
	communities: { label: "Сообщества" },
	authors: { label: "Авторы" },
	faq: { label: "FAQ" },
	finder: { label: "Подбор сообщества" },
	bookmarks: { label: "Закладки" },
	about: { label: "О проекте" },
	privacy: { label: "Конфиденциальность" },
	terms: { label: "Условия" },
	disclaimer: { label: "Дисклеймер" },
	"editorial-policy": { label: "Редакционная политика" },
}

const crumbs = parts.map((part, index) => {
	const href = `/${parts.slice(0, index + 1).join("/")}/`
	const decoded = decodeURIComponent(part)
	const isLast = index === parts.length - 1
	const mapped = labelMap[decoded]
	return {
		href,
		label: isLast && currentLabel ? currentLabel : (mapped?.label || decoded.replace(/-/g, " ")),
		isLast,
	}
})
---

{
	cleanPath !== "/" && (
		<nav aria-label="Хлебные крошки" class="w-full overflow-x-auto">
			<ol class="flex min-w-max items-center gap-2 rounded-xl border border-[color:var(--border)] bg-[color:var(--surface)]/85 px-3 py-2 text-sm">
				<li>
					<a href="/" class="rounded-full px-2 py-1 text-[color:var(--muted)] transition hover:bg-[color:var(--bg)] hover:text-[color:var(--text)]">
						Главная
					</a>
				</li>
				{
					crumbs.map((crumb) => (
						<>
							<li aria-hidden="true" class="text-[color:var(--muted)]">/</li>
							<li>
								{
									crumb.isLast ? (
										<span class="rounded-full bg-[color:var(--bg)] px-2 py-1 font-medium text-[color:var(--text)]">
											{crumb.label}
										</span>
									) : (
										<a
											href={crumb.href}
											class="rounded-full px-2 py-1 text-[color:var(--muted)] transition hover:bg-[color:var(--bg)] hover:text-[color:var(--text)]"

										>
											{crumb.label}
										</a>
									)
								}
							</li>
						</>
					))
				}
			</ol>
		</nav>
	)
}
