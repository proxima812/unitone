---
import ArchiveFilter from "@/components/svelte/ArchiveFilter.svelte";
import { listPublishedArticles } from "@/lib/db/articles";
import Layout from "@/layouts/Layout.astro";

export const prerender = false;

const archives = await listPublishedArticles();

const archivesTags = [] as string[];
---

<Layout
  title="Статьи 12 шагов"
  description="Статьи о 12 шагах: шаги выздоровления, практики, темы и опыт."
>
  <ArchiveFilter client:load tags={archivesTags} />

  <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3" data-posts>
    {
      archives.map((item) => (
        <a href={`/archive/${item.slug}/`} class="block relative" data-author={item.author_name || ""}>
          <div class="rounded-2xl p-2">
            <article class="flex h-full flex-col gap-3 rounded-2xl border border-[color:var(--border)] bg-[color:var(--surface)] p-5">
              <h2 class="line-clamp-2 text-xl font-semibold leading-tight text-[color:var(--text)]">{item.title}</h2>
              <p class="line-clamp-3 text-[color:var(--muted)]">{item.description || ""}</p>
              <div class="mt-auto flex items-center justify-between gap-2 text-sm text-[color:var(--muted)]">
                <span>{item.author_name || "Unity One"}</span>
                {item.published_at && (
                  <time datetime={item.published_at}>
                    {new Date(item.published_at).toLocaleDateString("ru-RU", {
                      year: "numeric",
                      month: "short",
                      day: "numeric",
                    })}
                  </time>
                )}
              </div>
            </article>
          </div>
        </a>
      ))
    }
  </div>
</Layout>
