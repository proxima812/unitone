---
import { communities } from "@/data/communities"
import Layout from "@/layouts/Layout.astro"
import { i18nKeys } from "@/lib/i18n-runtime"
import { Icon } from "astro-icon/components"

const categories = [
	"üç∑ –ê–ª–∫–æ–≥–æ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏",
	"üíä –ù–∞—Ä–∫–æ—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏",
	"üë™ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è –±–ª–∏–∑–∫–∏—Ö",
	"üçΩÔ∏è –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∏—â–µ–π",
	"üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏",
	"üåç –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã",
	"üé® –¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏",
	"‚ôª –û–±—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏",
	"üß† –ü—Å–∏—Ö–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–∞",
	"üîñ –î—Ä—É–≥–æ–µ",
]
---

<Layout
	title="–ü–æ–∏—Å–∫ –∞–Ω–æ–Ω–∏–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"
	description="–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ 12‚Äë—à–∞–≥–æ–≤—ã—Ö —Å–æ–æ–±—â–µ—Å—Ç–≤ –∏ –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –Ω—É–∂–Ω–æ–π –≥—Ä—É–ø–ø—ã."
	titleKey={i18nKeys.finder.title}
	descriptionKey={i18nKeys.finder.description}
>
	<div id="category-filters" class="flex flex-wrap justify-center gap-2 mb-6">
		{
			categories.map(category => {
				const count = communities.filter(item => item.category === category).length
				return (
					<button
						class="category-button px-3 py-1 cursor-pointer rounded-full border border-[color:var(--border)] text-sm transition-all duration-75 ease-in bg-[color:var(--surface)]"
						data-category={category}
					>
						{category} ({count})
					</button>
				)
			})
		}
		<button
			class="category-button px-3 py-1 transition-all duration-75 ease-in cursor-pointer rounded-full bg-[color:var(--surface)] border border-[color:var(--border)] text-sm"
			data-category="all"
			data-i18n="finder.showAll"
			data-i18n-param-count={String(communities.length)}
		>
			–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ ({communities.length})
		</button>
	</div>

	<section
		id="community-list"
		class="grid grid-cols-1 items-start gap-6 md:gap-3 md:grid-cols-2 lg:grid-cols-3"
	>
		{
			categories.map(category => (
				<div class="flex flex-col shadow-2xs bg-[color:var(--surface)] border border-[color:var(--border)] rounded-xl">
					<h3 class="text-xl p-6 font-medium">{category}</h3>
					{communities &&
						communities
							.filter(item => item.category === category)
							.map(item => (
								<article
									data-category={item.category}
									class="border-t border-[color:var(--border)] p-3 rounded-md flex flex-col"
								>
									<h2 class="font-medium">{item.title}</h2>
									<p class="mt-1 text-sm text-[color:var(--muted)]">
										{item.description}
									</p>
									<div class="flex gap-1 items-start mt-3">
										<a
											href={item.tg_group_link_topic}
											aria-label={item.title}
											target="_blank"
											class={`px-2 p-1.5 text-sm text-[color:var(--text)] border border-[color:var(--border)] flex items-center gap-1 justify-center hover:bg-[color:var(--bg)] transition-colors duration-75 ease-in rounded-md`}
										>
											<Icon name="mdi:telegram" />
											<span class="font-medium" data-i18n="finder.descriptionButton">–û–ø–∏—Å–∞–Ω–∏–µ</span>
										</a>
										{item.wikipedia && (
											<a
												href={item.wikipedia}
												aria-label={item.title}
												target="_blank"
												class="px-2 p-1.5 text-sm text-[color:var(--muted)] border border-[color:var(--border)] rounded-md flex items-center gap-1 justify-center hover:bg-[color:var(--bg)] transition-colors duration-75 ease-in"
											>
												<Icon name="mdi:wikipedia" />
												<span class="font-medium" data-i18n="finder.wikipediaButton">Wikipedia</span>
											</a>
										)}
									</div>
									<div class="flex gap-1 mt-1 items-start">
										<a
											href={`https://yandex.ru/search/?text=${item.title}`}
											target="_blank"
											class={`px-2 p-1.5 text-sm text-[color:var(--muted)] border border-[color:var(--border)] flex items-center gap-1 justify-center hover:bg-[color:var(--bg)] transition-colors duration-75 ease-in rounded-md`}
										>
											<Icon name="mdi:subdirectory-arrow-right" />
											<span class="font-medium" data-i18n="finder.findYandex">–ù–∞–π—Ç–∏ –≤ Yandex</span>
										</a>
										<a
											href={`https://www.google.com/search?q=${item.title}`}
											target="_blank"
											class={`px-2 p-1.5 text-sm text-[color:var(--muted)] border border-[color:var(--border)] flex items-center gap-1 justify-center hover:bg-[color:var(--bg)] transition-colors duration-75 ease-in rounded-md`}
										>
											<Icon name="mdi:google" />
											<span class="font-medium" data-i18n="finder.findGoogle">–ù–∞–π—Ç–∏ –≤ Google</span>
										</a>
									</div>
								</article>
							))}
				</div>
			))
		}
	</section>

	<script>
		document.addEventListener("DOMContentLoaded", () => {
			const buttons = document.querySelectorAll(".category-button")
			const articles = document.querySelectorAll("#community-list article")

			buttons.forEach(button => {
				button.addEventListener("click", () => {
					const selectedCategory = button.dataset.category

					// –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
					buttons.forEach(btn => btn.classList.remove("active", "font-medium"))

					// –í—ã–¥–µ–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
					button.classList.add("active", "font-medium")

					// –§–∏–ª—å—Ç—Ä—É–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
					articles.forEach(article => {
						if (
							selectedCategory === "all" ||
							article.dataset.category === selectedCategory
						) {
							article.parentElement.style.display = "flex"
						} else {
							article.parentElement.style.display = "none"
						}
					})
				})
			})
		})
	</script>

	<style>
		.active {
			background-color: var(--text);
			color: var(--bg);
		}
	</style>
</Layout>
