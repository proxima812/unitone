import fs from "node:fs"
import path from "node:path"
import { spawnSync } from "node:child_process"

const EXCLUDE_FILE = "docs/CONTENT_EXCLUDE.md"
const dryRun = process.argv.includes("--dry-run")

function loadExcludeSet() {
	if (!fs.existsSync(EXCLUDE_FILE)) return new Set()
	const raw = fs.readFileSync(EXCLUDE_FILE, "utf8")
	const items = raw
		.split("\n")
		.map((line) => line.trim())
		.filter((line) => line && !line.startsWith("#") && line.startsWith("src/"))
	return new Set(items)
}

function splitFrontmatter(raw) {
	if (!raw.startsWith("---\n")) return null
	const end = raw.indexOf("\n---\n", 4)
	if (end === -1) return null
	return { fm: raw.slice(4, end), body: raw.slice(end + 5) }
}

function pick(re, source, fallback = "") {
	const m = source.match(re)
	if (!m) return fallback
	return m[1].trim().replace(/^['"]|['"]$/g, "")
}

function parseTags(fm) {
	const lines = fm.split("\n")
	const i = lines.findIndex((l) => /^tags:\s*$/.test(l))
	if (i === -1) return []
	const out = []
	for (let j = i + 1; j < lines.length; j++) {
		if (!/^\s+-\s+/.test(lines[j])) break
		out.push(lines[j].replace(/^\s+-\s+/, "").trim())
	}
	return out
}

function parseAuthor(fm) {
	const lines = fm.split("\n")
	const i = lines.findIndex((l) => /^author:\s*$/.test(l))
	if (i !== -1 && /^\s+-\s+\S/.test(lines[i + 1] || "")) {
		return lines[i + 1].replace(/^\s+-\s+/, "").trim()
	}
	return pick(/^author:\s*(.+)$/m, fm, "Klia78")
}

function cleanTitle(title) {
	return title.replace(/^"|"$/g, "")
}

function makePost({ author, title, description, tags }) {
	const t = cleanTitle(title)
	const d = description || "ÐšÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾: Ð´ÐµÑ€Ð¶Ð¸Ð¼ Ñ„Ð¾ÐºÑƒÑ Ð½Ð° ÑÑƒÑ‚Ð¸ Ð¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¸."
	const tagText = tags.length ? ` Ð¤Ð¾ÐºÑƒÑ Ñ‚ÐµÐ¼Ñ‹: ${tags.join(", ")}.` : ""

	if (author === "Klia78") {
		return `${t} Ñ€Ð°Ð·Ð±Ð¸Ñ€Ð°ÑŽ Ð¿Ñ€ÑÐ¼Ð¾ Ð¸ Ð±ÐµÐ· ÑƒÐºÑ€Ð°ÑˆÐµÐ½Ð¸Ð¹: Ð±ÐµÑ€Ñ‘Ð¼ Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¸Ð· Ñ‚ÐµÐ¼Ñ‹ Ð¸ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð¸Ð¼ Ð² Ð¿Ð¾Ð½ÑÑ‚Ð½Ð¾Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð½Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ.${tagText} ${d}

## Ð§Ñ‚Ð¾ Ð²Ð°Ð¶Ð½Ð¾ ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ
Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ð¾Ð»ÐµÐ·Ð½Ð¾ Ð½Ð°Ð·Ð²Ð°Ñ‚ÑŒ ÑƒÐ·ÐºÐ¾Ðµ Ð¼ÐµÑÑ‚Ð¾ Ð¸ Ð¿ÐµÑ€ÐµÑÑ‚Ð°Ñ‚ÑŒ Ð¼Ð°ÑÐºÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐµÐ³Ð¾ Ð¾Ð±Ñ‰Ð¸Ð¼Ð¸ ÑÐ»Ð¾Ð²Ð°Ð¼Ð¸. ÐÐ° Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ðµ Ð´Ñ€Ð°Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ, Ð° Ñ‚Ð¾Ñ‡Ð½Ð¾Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ ÑˆÐ°Ð³Ð°.

## ÐšÐ°Ðº Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ ÑÐµÐ³Ð¾Ð´Ð½Ñ
Ð ÐµÑˆÐµÐ½Ð¸Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ð¼ Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ð¼Ñ‹Ð¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÐµÐ³Ð¾ Ð¼Ð¾Ð¶Ð½Ð¾ Ð±Ñ‹Ð»Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ðº Ð²ÐµÑ‡ÐµÑ€Ñƒ. Ð•ÑÐ»Ð¸ ÑˆÐ°Ð³ Ð½ÐµÐ»ÑŒÐ·Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ, Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð¿Ð¾ÐºÐ° ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ñ€Ð°Ð·Ð¼Ñ‹Ñ‚Ð°.

1. Ð—Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€ÑƒÐ¹ Ð¾Ð´Ð½Ñƒ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½ÑƒÑŽ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð¿Ð¾ Ñ‚ÐµÐ¼Ðµ.
2. Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸ ÐµÑ‘ Ð² Ð·Ð°Ñ€Ð°Ð½ÐµÐµ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð¼ÐµÐ¶ÑƒÑ‚Ð¾Ðº Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸.
3. Ð’ ÐºÐ¾Ð½Ñ†Ðµ Ð´Ð½Ñ Ð·Ð°Ð¿Ð¸ÑˆÐ¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¸ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ ÑˆÐ°Ð³.

Ð˜Ñ‚Ð¾Ð³ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹: Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¾ÑÑ‚ÑŒ Ð¸ Ð´Ð¸ÑÑ†Ð¸Ð¿Ð»Ð¸Ð½Ð° Ð´Ð°ÑŽÑ‚ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð±Ñ‹ÑÑ‚Ñ€ÐµÐµ, Ñ‡ÐµÐ¼ Ð´Ð»Ð¸Ð½Ð½Ñ‹Ðµ Ñ€Ð°ÑÑÑƒÐ¶Ð´ÐµÐ½Ð¸Ñ. ÐšÐ¾Ð³Ð´Ð° Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð¸Ð·Ð¼ÐµÑ€Ð¸Ð¼Ð¾, Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑ ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ Ð·Ð°Ð¼ÐµÑ‚Ð½Ñ‹Ð¼ ÑƒÐ¶Ðµ Ð² Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐ¸Ðµ Ð´Ð½Ð¸.
`
	}

	if (author === "SamGold") {
		return `Ð¢ÐµÐ¼Ð° Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾ Ñ€Ð°Ð±Ð¾Ñ‡Ð°Ñ ðŸ˜„: Ð±ÐµÐ· Ð»Ð¸ÑˆÐ½ÐµÐ¹ Ñ‚ÐµÐ¾Ñ€Ð¸Ð¸ Ð±ÐµÑ€Ñ‘Ð¼ Ð¿Ð¾Ð½ÑÑ‚Ð½Ñ‹Ð¹ ÐºÑƒÑÐ¾Ðº Ð¸ ÑÑ€Ð°Ð·Ñƒ Ñ‚Ð°Ñ‰Ð¸Ð¼ ÐµÐ³Ð¾ Ð² Ð´ÐµÐ½ÑŒ ðŸ”¥. ${d}${tagText}

## Ð“Ð´Ðµ Ñ‚ÑƒÑ‚ ÑÐ¼Ñ‹ÑÐ»
Ð•ÑÐ»Ð¸ Ñ‡ÐµÑÐ½Ð¾, Ð»ÑƒÑ‡ÑˆÐµ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ð¹ ÑˆÐ°Ð³ ÑÐµÐ¹Ñ‡Ð°Ñ Ñ‡ÐµÐ¼ Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð»Ð°Ð½ Ð¿Ð¾Ñ‚Ð¾Ð¼. ÐšÐ¾Ð³Ð´Ð° Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑˆÑŒ Ñ Ð¼Ð°Ð»Ð¾Ð³Ð¾, ÑÐ¾Ð¿Ñ€Ð¾Ñ‚Ð¸Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð¸Ð¶Ðµ Ð¸ Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ‚ÑŒÑÑ Ð¿Ñ€Ð¾Ñ‰Ðµ ðŸ™Œ.

## Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð±ÐµÐ· Ð¿ÐµÑ€ÐµÐ³Ñ€ÑƒÐ·Ð°
Ð¢ÑƒÑ‚ Ð³Ð»Ð°Ð²Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¸Ð½Ñ†Ñ‹Ð¿ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹: Ð½Ðµ Ñ€Ð°Ð·Ð¼Ð°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ ÑƒÑÐ¸Ð»Ð¸Ñ Ð¿Ð¾ Ð²ÑÐµÐ¼Ñƒ ÑÑ€Ð°Ð·Ñƒ. Ð’Ñ‹Ð±Ñ€Ð°Ð» Ð¾Ð´Ð½Ñƒ Ñ‚Ð¾Ñ‡ÐºÑƒ, ÑÐ´ÐµÐ»Ð°Ð», Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ð» Ð¸ ÑƒÐ¶Ðµ ÐµÑÑ‚ÑŒ Ð¾Ð¿Ð¾Ñ€Ð° ðŸš€.

1. ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸ Ð¾Ð´Ð¸Ð½ ÑˆÐ°Ð³ Ð¸ Ð·Ð°Ð¿Ð¸ÑˆÐ¸ ÐµÐ³Ð¾ Ñ ÑƒÑ‚Ñ€Ð°.
2. Ð¡Ð´ÐµÐ»Ð°Ð¹ ÐµÐ³Ð¾ ÑÐµÐ³Ð¾Ð´Ñ Ð´Ð¾ Ð²ÐµÑ‡ÐµÑ€Ð° Ð±ÐµÐ· Ð¿ÐµÑ€ÐµÐ½Ð¾ÑÐ¾Ð².
3. ÐžÑ‚Ð¼ÐµÑ‚ÑŒ Ñ‡Ñ‚Ð¾ ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð»Ð¾ Ð¸ Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð²Ñ‚Ñ€Ð°.

Ð’ Ñ„Ð¸Ð½Ð°Ð»Ðµ Ð²ÑÑ‘ Ð´Ð¾Ð²Ð¾Ð»ÑŒÐ½Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ð¾: Ð¼ÐµÐ½ÑŒÑˆÐµ ÑÑƒÐµÑ‚Ñ‹, Ð±Ð¾Ð»ÑŒÑˆÐµ Ñ€Ð¸Ñ‚Ð¼Ð° Ð¸ Ð¿Ð¾Ð½ÑÑ‚Ð½Ñ‹Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹. ÐžÑˆÐ¸Ð±Ð°Ñ‚ÑÑ Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð¾, ÐµÑÐ»Ð¸ Ñ‚Ñ‹ Ð´Ð²Ð¸Ð³Ð°ÐµÑˆÑŒÑÑ Ð¸ Ð²Ð¸Ð´Ð¸ÑˆÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚.
`
	}

	if (author === "just_green1") {
		return `Ð¢ÐµÐºÑÑ‚ Ñ€Ð°ÑÑÐ¼Ð°Ñ‚Ñ€Ð¸Ð²Ð°ÐµÑ‚ Ñ‚ÐµÐ¼Ñƒ Ð² Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´Ð½Ð¾Ð¹ Ð¿Ð»Ð¾ÑÐºÐ¾ÑÑ‚Ð¸ Ð¸ Ð±ÐµÐ· ÑÐ¼Ð¾Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¾Ñ†ÐµÐ½Ð¾Ðº. ${d}${tagText} Ð”Ð°Ð»ÑŒÑˆÐµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð¸ Ð½Ð°Ð±Ð»ÑŽÐ´Ð°ÐµÐ¼Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚.

## Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ Ð»Ð¾Ð³Ð¸ÐºÐ°
Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ñ„Ð¸ÐºÑÐ¸Ñ€ÑƒÐµÑ‚ÑÑ Ð¸ÑÑ…Ð¾Ð´Ð½Ð°Ñ Ñ‚Ð¾Ñ‡ÐºÐ°, Ð·Ð°Ñ‚ÐµÐ¼ Ð²Ñ‹Ð±Ð¸Ñ€Ð°ÐµÑ‚ÑÑ ÐµÐ´Ð¸Ð½Ð¸Ñ‡Ð½Ð¾Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð² Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ð¸. Ð¢Ð°ÐºÐ¾Ð¹ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ ÑˆÑƒÐ¼ Ð¸ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ ÑÑ€Ð°Ð²Ð½Ð¸Ð²Ð°Ñ‚ÑŒ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð´Ð¾ Ð¸ Ð¿Ð¾ÑÐ»Ðµ.

## ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
Ð›ÑŽÐ±Ð¾Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð¸Ð¼ÐµÑ‚ÑŒ ÐºÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¹ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ Ð² Ð¿Ñ€ÐµÐ´ÐµÐ»Ð°Ñ… ÑÑƒÑ‚Ð¾Ðº. Ð•ÑÐ»Ð¸ ÐºÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¹ Ð½Ðµ Ð·Ð°Ð´Ð°Ð½, Ð·Ð°Ð´Ð°Ñ‡Ð° Ð½Ðµ ÑÑ‡Ð¸Ñ‚Ð°ÐµÑ‚ÑÑ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½Ð½Ð¾Ð¹.

1. Ð¡Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ð¸Ñ€ÑƒÐ¹ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð² Ð¾Ð´Ð½Ð¾Ð¼ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¸.
2. ÐÐ°Ð·Ð½Ð°Ñ‡ÑŒ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ.
3. Ð—Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€ÑƒÐ¹ Ñ„Ð°ÐºÑ‚ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¸ ÐºÑ€Ð°Ñ‚ÐºÐ¸Ð¹ Ð²Ñ‹Ð²Ð¾Ð´.

Ð—Ð°ÐºÑ€Ñ‹Ð²Ð°ÑŽÑ‰Ð¸Ð¹ Ð²Ñ‹Ð²Ð¾Ð´: ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ð½Ðµ Ð¾Ñ‚ Ð¼Ð¾Ñ‚Ð¸Ð²Ð°Ñ†Ð¸Ð¸, Ð° Ð¾Ñ‚ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€ÑÐµÐ¼Ð¾Ð¹ ÑÑ…ÐµÐ¼Ñ‹. Ð¡Ñ…ÐµÐ¼Ð° Ð¿Ñ€Ð¾ÑÑ‚Ð°, Ð½Ð¾ Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ñ‚Ð° Ð´ÐµÐ»Ð°ÐµÑ‚ ÐµÑ‘ Ð¿Ñ€Ð¸Ð³Ð¾Ð´Ð½Ð¾Ð¹ Ð´Ð»Ñ ÐµÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾Ð¹ Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐ¸.
`
	}

	if (author === "Xima") {
		return `Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ñ‚ÐµÐ¼Ñ‹ Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ Ð²Ñ‹Ð³Ð»ÑÐ´Ð¸Ñ‚ Ñ‚Ð°Ðº: Ð¼Ñ‹ Ð´Ð¾Ð»Ð³Ð¾ Ð´ÑƒÐ¼Ð°ÐµÐ¼, Ð¿Ð¾Ñ‚Ð¾Ð¼ ÐµÑ‰Ñ‘ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð´ÑƒÐ¼Ð°ÐµÐ¼, Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ÑÐ»Ðµ ÑÑ‚Ð¾Ð³Ð¾ Ð½Ð°ÐºÐ¾Ð½ÐµÑ† Ð´ÐµÐ»Ð°ÐµÐ¼ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ñ…Ð¾Ð´ ðŸ™‚. ${d}${tagText} Ð’ ÑÑ‚Ð¾Ð¼ Ð½ÐµÑ‚ Ñ‚Ñ€Ð°Ð³ÐµÐ´Ð¸Ð¸, Ð½Ð¾ ÐµÑÑ‚ÑŒ Ð¿Ð¾Ð»ÐµÐ·Ð½Ñ‹Ð¹ Ð²Ñ‹Ð²Ð¾Ð´.

## ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ð¼Ñ‹ Ñ‚Ð¾Ñ€Ð¼Ð¾Ð·Ð¸Ð¼
ÐžÐ±Ñ‹Ñ‡Ð½Ð¾ Ñ…Ð¾Ñ‡ÐµÑ‚ÑÑ Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¹ ÑÑÐ½Ð¾ÑÑ‚Ð¸ Ð·Ð°Ñ€Ð°Ð½ÐµÐµ, Ñ…Ð¾Ñ‚Ñ Ð¾Ð½Ð° Ð¿Ð¾Ñ‡Ñ‚Ð¸ Ð²ÑÐµÐ³Ð´Ð° Ð¿Ñ€Ð¸Ñ…Ð¾Ð´Ð¸Ñ‚ ÑƒÐ¶Ðµ Ð² Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐµ. ÐŸÐ°Ñ€Ð°Ð´Ð¾ÐºÑ Ð² Ñ‚Ð¾Ð¼, Ñ‡Ñ‚Ð¾ Ð¼Ð¾Ð·Ð³ Ð¿Ñ€Ð¾ÑÐ¸Ñ‚ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ð¹, Ð° Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐ° Ð¿Ñ€Ð¾ÑÐ¸Ñ‚ Ð¿ÐµÑ€Ð²Ð¾Ð³Ð¾ ÑˆÐ°Ð³Ð°.

## ÐšÐ°Ðº Ñ€Ð°Ð·Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ ÑÑ‚Ð¾ Ð² Ð¿Ð¾Ð»ÑŒÐ·Ñƒ ÑÐµÐ±Ðµ
ÐšÐ¾Ð³Ð´Ð° ÑˆÐ°Ð³ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ð¹ Ð¸ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹, Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ‚ÑŒÑÑ Ð»ÐµÐ³Ñ‡Ðµ, Ð° ÑÑ„Ñ„ÐµÐºÑ‚ Ð·Ð°Ð¼ÐµÑ‚ÐµÐ½ Ð±Ñ‹ÑÑ‚Ñ€ÐµÐµ. Ð”Ð°Ð»ÑŒÑˆÐµ Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¾ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ, Ð¸ ÑÑ‚Ð¾ Ð·Ð°Ð¼ÐµÑ‚Ð½Ð¾ ÑÐ½Ð¸Ð¶Ð°ÐµÑ‚ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½Ð¸Ð¹ ÑˆÑƒÐ¼.

1. Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð½Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ.
2. Ð¡Ð´ÐµÐ»Ð°Ð¹ ÐµÐ³Ð¾ Ð±ÐµÐ· Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… ÑƒÑÐ»Ð¾Ð²Ð¸Ð¹.
3. Ð—Ð°Ð¿Ð¸ÑˆÐ¸, Ñ‡Ñ‚Ð¾ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð¾ÑÑŒ ÑÑ€Ð°Ð·Ñƒ Ð¿Ð¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ.

Ð’Ñ‹Ð²Ð¾Ð´ ÑÐ¿Ð¾ÐºÐ¾Ð¹Ð½Ñ‹Ð¹: Ð´Ð»Ð¸Ð½Ð½Ñ‹Ðµ Ð¾Ð±ÑŠÑÑÐ½ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð»ÐµÐ·Ð½Ñ‹ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ÑÐ»Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ, Ð° Ð½Ðµ Ð²Ð¼ÐµÑÑ‚Ð¾ Ð½ÐµÐ³Ð¾. Ð¡Ð´ÐµÐ»Ð°Ð» ÑˆÐ°Ð³, ÑƒÐ²Ð¸Ð´ÐµÐ» Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚, Ð¿Ð¾Ð¿Ñ€Ð°Ð²Ð¸Ð» ÐºÑƒÑ€Ñ Ð¸ Ð¿Ð¾ÑˆÑ‘Ð» Ð´Ð°Ð»ÑŒÑˆÐµ Ð±ÐµÐ· Ð»Ð¸ÑˆÐ½ÐµÐ¹ Ð´Ñ€Ð°Ð¼Ñ‹.
`
	}

	if (author === "yuliaM") {
		return `ÐœÐ½Ðµ Ð½Ñ€Ð°Ð²Ð¸Ñ‚ÑÑ ÑÑ‚Ð° Ñ‚ÐµÐ¼Ð° âœ¨, Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ Ñ‡Ñ‚Ð¾ Ð² Ð½ÐµÐ¹ Ð¼Ð½Ð¾Ð³Ð¾ Ð¶Ð¸Ð·Ð½Ð¸ Ð¸ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð¾Ð¿Ð¾Ñ€Ñ‹ ðŸ’›. ÐšÐ¾Ð³Ð´Ð° Ð´Ð²Ð¸Ð³Ð°ÐµÑˆÑŒÑÑ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¸Ð¼Ð¸ ÑˆÐ°Ð³Ð°Ð¼Ð¸ ðŸŒ¿, Ð´ÐµÐ½ÑŒ ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ ÑÐ¿Ð¾ÐºÐ¾Ð¹Ð½ÐµÐµ Ð¸ ÑÑÐ½ÐµÐµ ðŸ˜Š. ${d}${tagText} Ð˜ Ð´Ð°, ÑÑ‚Ð¾ Ð¿Ñ€Ð°Ð²Ð´Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ðŸ’«.

## Ð§Ñ‚Ð¾ Ð·Ð´ÐµÑÑŒ Ð´Ð°Ñ‘Ñ‚ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚
Ð§ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð²Ð·Ð³Ð»ÑÐ´ Ð½Ð° ÑÐµÐ±Ñ ÑÐ½Ð¸Ð¼Ð°ÐµÑ‚ Ð»Ð¸ÑˆÐ½ÐµÐµ Ð½Ð°Ð¿Ñ€ÑÐ¶ÐµÐ½Ð¸Ðµ ðŸ“˜ Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½ÑŽÑŽ ÑƒÑÑ‚Ð¾Ð¹Ñ‡Ð¸Ð²Ð¾ÑÑ‚ÑŒ ðŸŒ¸. Ð ÐºÐ¾Ð³Ð´Ð° ÐµÑÑ‚ÑŒ ÑƒÑÑ‚Ð¾Ð¹Ñ‡Ð¸Ð²Ð¾ÑÑ‚ÑŒ, Ð³Ð¾Ñ€Ð°Ð·Ð´Ð¾ Ð»ÐµÐ³Ñ‡Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ Ð²Ð¾Ð²Ñ€ÐµÐ¼Ñ ðŸ™Œ.

## ÐšÐ°Ðº ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ ÑÑ‚Ð¾ Ð¿Ñ€Ð¸ÑÑ‚Ð½Ð¾Ð¹ Ð¿Ñ€Ð¸Ð²Ñ‹Ñ‡ÐºÐ¾Ð¹
Ð›ÑƒÑ‡ÑˆÐµ Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð¿Ð¾ÑÐ¸Ð»ÑŒÐ½Ñ‹Ð¹ Ñ‚ÐµÐ¼Ð¿ Ð¸ Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ ÐµÐ³Ð¾ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð´ÐµÐ½ÑŒ ðŸŒž. Ð¢Ð¾Ð³Ð´Ð° Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¾ Ð¿Ñ€Ð¾Ð³Ñ€ÐµÑÑÐ°, Ð¸ Ðº ÑÐµÐ±Ðµ ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ Ð±Ð¾Ð»ÑŒÑˆÐµ ÑƒÐ²Ð°Ð¶ÐµÐ½Ð¸Ñ ðŸ’š.

1. Ð¡ ÑƒÑ‚Ñ€Ð° Ð²Ñ‹Ð±ÐµÑ€Ð¸ Ð¾Ð´Ð¸Ð½ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ ÑˆÐ°Ð³.
2. Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸ ÐµÐ³Ð¾ Ð² ÐºÐ¾Ð¼Ñ„Ð¾Ñ€Ñ‚Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð±ÐµÐ· ÑÐ¿ÐµÑˆÐºÐ¸.
3. Ð’ÐµÑ‡ÐµÑ€Ð¾Ð¼ Ð·Ð°Ñ„Ð¸ÐºÑÐ¸Ñ€ÑƒÐ¹, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»Ð¾ÑÑŒ Ð»ÑƒÑ‡ÑˆÐµ Ð²ÑÐµÐ³Ð¾.

Ð¤Ð¸Ð½Ð°Ð» Ñƒ ÑÑ‚Ð¾Ð¹ Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐ¸ Ð¾Ñ‡ÐµÐ½ÑŒ Ñ‚Ñ‘Ð¿Ð»Ñ‹Ð¹ ðŸ¤: Ñ‚Ñ‹ Ð²Ð¸Ð´Ð¸ÑˆÑŒ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ, Ñ‡ÑƒÐ²ÑÑ‚Ð²ÑƒÐµÑˆÑŒ ÑÐ¼Ñ‹ÑÐ» Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÑˆÑŒ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚ Ñ ÑÐ¾Ð±Ð¾Ð¹ ðŸŒº. Ð˜Ð¼ÐµÐ½Ð½Ð¾ Ñ‚Ð°Ðº Ð¿ÑƒÑ‚ÑŒ ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ Ð¶Ð¸Ð²Ñ‹Ð¼ Ð¸ Ð¿Ð¾-Ð½Ð°ÑÑ‚Ð¾ÑÑ‰ÐµÐ¼Ñƒ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÑŽÑ‰Ð¸Ð¼ ðŸ•Šï¸.
`
	}

	if (author === "Svetlana") {
		return `Ð¢ÐµÐ¼Ð° Ð¿Ð¾Ð½ÑÑ‚Ð½Ð°Ñ Ð¸ Ð¶Ð¸Ð·Ð½ÐµÐ½Ð½Ð°Ñ. Ð·Ð´ÐµÑÑŒ Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ Ð½Ðµ Ñ‚Ð¾Ñ€Ð¾Ð¿Ð¸Ñ‚ÑŒÑÑ Ð¸ Ð½Ðµ ÑƒÑÐ»Ð¾Ð¶Ð½ÑÑ‚ÑŒ. ${d}${tagText} ÐµÑÐ»Ð¸ Ð¸Ð´Ñ‚Ð¸ ÑÐ¿Ð¾ÐºÐ¾Ð¹Ð½Ð¾, ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ Ð»ÐµÐ³Ñ‡Ðµ Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ñ€Ð¸Ñ‚Ð¼ Ð¸ Ð½Ðµ ÑÑ€Ñ‹Ð²Ð°Ñ‚ÑŒÑÑ Ð² ÐºÑ€Ð°Ð¹Ð½Ð¾ÑÑ‚Ð¸.

## Ð§Ñ‚Ð¾ ÑÑ‚Ð¾Ð¸Ñ‚ ÑƒÑ‡ÐµÑÑ‚ÑŒ
Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð»ÑƒÑ‡ÑˆÐµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ÑŒ Ð¾Ð´Ð½Ñƒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð½Ð° Ð´ÐµÐ½ÑŒ Ð¸ Ð½Ðµ Ñ€Ð°ÑÐ¿Ñ‹Ð»ÑÑ‚ÑŒÑÑ. Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÐµÑ‘ Ð² Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð±ÐµÐ· Ð´Ð¾Ð»Ð³Ð¸Ñ… Ð¾Ð±ÑÑƒÐ¶Ð´ÐµÐ½Ð¸Ð¹.

## ÐšÐ°Ðº Ð·Ð°ÐºÑ€ÐµÐ¿Ð¸Ñ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚
ÐŸÐ¾ÑÐ»Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð»ÐµÐ·Ð½Ð¾ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾ Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð²Ñ‹Ð²Ð¾Ð´ Ð¿Ð¾ Ñ„Ð°ÐºÑ‚Ñƒ. ÑÑ‚Ð¾ Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÐµÑ‚ ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð»Ð¸Ñ‡Ð½Ð¾ Ð´Ð»Ñ Ð²Ð°Ñ.

1. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¾Ð´Ð½Ñƒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð¿Ð¾ Ñ‚ÐµÐ¼Ðµ.
2. Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ ÐµÑ‘ Ð² Ð·Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚.
3. Ð—Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ð¹ Ð¸Ñ‚Ð¾Ð³ Ð² ÐºÐ¾Ð½Ñ†Ðµ Ð´Ð½Ñ.

Ð¡Ð¿Ð¾ÐºÐ¾Ð¹Ð½Ð°Ñ Ñ€ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð¾ÑÑ‚ÑŒ Ð¿Ð¾Ñ‡Ñ‚Ð¸ Ð²ÑÐµÐ³Ð´Ð° Ð´Ð°Ñ‘Ñ‚ Ð»ÑƒÑ‡ÑˆÐ¸Ð¹ ÑÑ„Ñ„ÐµÐºÑ‚, Ñ‡ÐµÐ¼ Ñ€ÐµÐ´ÐºÐ¸Ðµ Ñ€Ñ‹Ð²ÐºÐ¸. Ð¢Ð°ÐºÐ¾Ð¹ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ Ð¿Ñ€Ð¾Ñ‰Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°Ñ‚ÑŒ Ð½ÐµÐ´ÐµÐ»ÑÐ¼Ð¸, Ð¸ Ð¾Ñ‚ ÑÑ‚Ð¾Ð³Ð¾ Ð¿Ð¾ÑÐ²Ð»ÑÐµÑ‚ÑÑ ÑƒÐ²ÐµÑ€ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ Ð² Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐµ.

ÐŸÐ¸ÑÐ°Ð»Ð° Ð¡Ð²ÐµÑ‚Ð»Ð°Ð½Ð°. Ð¡Ð¿Ð°ÑÐ¸Ð±Ð¾ Ð·Ð° Ð¿Ñ€Ð¾Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ!
`
	}

	return `${d}\n`
}

const listRaw = spawnSync("rg", ["-l", "^author:", "src/data", "-S"], { encoding: "utf8" })
if (listRaw.status !== 0) {
	console.error(listRaw.stderr || "Failed to list files")
	process.exit(1)
}

const excluded = loadExcludeSet()
const files = listRaw.stdout
	.trim()
	.split("\n")
	.filter(Boolean)
	.filter((file) => !excluded.has(file))
	.sort()

let updated = 0
for (const file of files) {
	const abs = path.resolve(file)
	const raw = fs.readFileSync(abs, "utf8")
	const parsed = splitFrontmatter(raw)
	if (!parsed) continue

	const author = parseAuthor(parsed.fm)
	const title = pick(/^title:\s*(.+)$/m, parsed.fm, path.basename(file, path.extname(file)))
	const description = pick(/^description:\s*(.+)$/m, parsed.fm, "")
	const tags = parseTags(parsed.fm)

	const body = makePost({ author, title, description, tags })
	const next = `---\n${parsed.fm}\n---\n${body.endsWith("\n") ? body : `${body}\n`}`
	if (dryRun) {
		console.log(`[DRY-RUN] ${file}`)
		continue
	}
	fs.writeFileSync(abs, next, "utf8")
	updated++
}

if (dryRun) {
	console.log(`Dry run complete. Candidate files: ${files.length}. Excluded: ${excluded.size}.`)
} else {
	console.log(`Rewritten ${updated} file(s). Excluded: ${excluded.size}.`)
}
